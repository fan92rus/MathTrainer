<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .info {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-input {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 8px;
        }
        .test-input:focus {
            border-color: #007bff;
            outline: none;
        }
        button {
            padding: 15px 30px;
            font-size: 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            margin: 10px 0;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–±–∏–ª—å–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã</h1>

    <div class="info">
        <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ:</h2>
        <div id="device-info"></div>
    </div>

    <div class="info">
        <h2>–°–æ—Å—Ç–æ—è–Ω–∏–µ Visual Viewport:</h2>
        <div id="viewport-info"></div>
    </div>

    <div class="info">
        <h2>–¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ –≤–≤–æ–¥–∞:</h2>
        <input type="number" class="test-input" placeholder="–ù–∞–∂–º–∏—Ç–µ —Å—é–¥–∞, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É" id="testInput">

        <button id="testButton">–ö–Ω–æ–ø–∫–∞ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å (–¥–æ–ª–∂–Ω–∞ —Å–∫—Ä—ã–≤–∞—Ç—å—Å—è)</button>
    </div>

    <div class="info">
        <h2>–õ–æ–≥ —Å–æ–±—ã—Ç–∏–π:</h2>
        <div id="event-log" style="max-height: 200px; overflow-y: auto; font-family: monospace; font-size: 12px;"></div>
    </div>

    <script>
        let keyboardHeight = 0;
        let isKeyboardOpen = false;

        const log = (message) => {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('event-log');
            logElement.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
        };

        const updateDeviceInfo = () => {
            const info = document.getElementById('device-info');
            info.innerHTML = `
                <strong>User Agent:</strong> ${navigator.userAgent}<br>
                <strong>Touch:</strong> ${'ontouchstart' in window ? '–î–∞' : '–ù–µ—Ç'}<br>
                <strong>Max Touch Points:</strong> ${navigator.maxTouchPoints}<br>
                <strong>–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –≤—ã—Å–æ—Ç–∞:</strong> ${window.innerHeight}px<br>
                <strong>–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —à–∏—Ä–∏–Ω–∞:</strong> ${window.innerWidth}px<br>
                <strong>Visual Viewport API:</strong> ${window.visualViewport ? '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è' : '–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è'}<br>
                <strong>Screen Orientation API:</strong> ${screen.orientation ? '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è' : '–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è'}
            `;
        };

        const updateViewportInfo = () => {
            const info = document.getElementById('viewport-info');

            if (window.visualViewport) {
                const heightDiff = window.innerHeight - window.visualViewport.height;
                const minKeyboardHeight = 150;

                keyboardHeight = heightDiff > minKeyboardHeight ? heightDiff :
                               (window.visualViewport.offsetTop > 30 ? window.visualViewport.offsetTop : 0);
                isKeyboardOpen = keyboardHeight > 0;

                info.innerHTML = `
                    <strong>Visual Viewport —à–∏—Ä–∏–Ω–∞:</strong> ${window.visualViewport.width}px<br>
                    <strong>Visual Viewport –≤—ã—Å–æ—Ç–∞:</strong> ${window.visualViewport.height}px<br>
                    <strong>Visual Viewport offsetTop:</strong> ${window.visualViewport.offsetTop}px<br>
                    <strong>–†–∞–∑–Ω–∏—Ü–∞ –≤—ã—Å–æ—Ç:</strong> ${heightDiff}px<br>
                    <strong>–í—ã—Å–æ—Ç–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã:</strong> ${keyboardHeight}px<br>
                    <strong>–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –æ—Ç–∫—Ä—ã—Ç–∞:</strong> ${isKeyboardOpen ? '–î–∞' : '–ù–µ—Ç'}
                `;
            } else {
                info.innerHTML = '<strong>Visual Viewport API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è</strong>';
                keyboardHeight = 0;
                isKeyboardOpen = false;
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –∫–Ω–æ–ø–∫–∏
            const button = document.getElementById('testButton');
            const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const hasTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
            const isPortrait = window.innerHeight >= window.innerWidth;

            const shouldHide = (isMobile || hasTouch) && isPortrait && isKeyboardOpen && keyboardHeight >= 150;

            button.classList.toggle('hidden', shouldHide);

            log(`–ö–Ω–æ–ø–∫–∞ ${shouldHide ? '—Å–∫—Ä—ã—Ç–∞' : '–ø–æ–∫–∞–∑–∞–Ω–∞'} (–º–æ–±–∏–ª—å–Ω—ã–π: ${isMobile || hasTouch}, –ø–æ—Ä—Ç—Ä–µ—Ç: ${isPortrait}, –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞: ${isKeyboardOpen}, –≤—ã—Å–æ—Ç–∞: ${keyboardHeight}px)`);
        };

        const updateViewport = () => {
            log('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ viewport...');
            updateViewportInfo();
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            updateDeviceInfo();
            updateViewportInfo();
            log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');

            // –°–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π
            if (window.visualViewport) {
                window.visualViewport.addEventListener('resize', updateViewport);
                window.visualViewport.addEventListener('scroll', updateViewport);
                log('Visual Viewport —Å–ª—É—à–∞—Ç–µ–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã');
            }

            window.addEventListener('resize', updateViewport);
            window.addEventListener('scroll', updateViewport);

            // –°–ª—É—à–∞—Ç–µ–ª–∏ —Ñ–æ–∫—É—Å–∞ –Ω–∞ input
            document.getElementById('testInput').addEventListener('focus', () => {
                log('Input –ø–æ–ª—É—á–∏–ª —Ñ–æ–∫—É—Å');
                setTimeout(updateViewport, 100); // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –ø–æ—è–≤–ª–µ–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
            });

            document.getElementById('testInput').addEventListener('blur', () => {
                log('Input –ø–æ—Ç–µ—Ä—è–ª —Ñ–æ–∫—É—Å');
                setTimeout(updateViewport, 100);
            });

            // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ
            if (screen.orientation && screen.orientation.lock) {
                screen.orientation.lock('portrait').catch(() => {
                    log('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é');
                });
            }
        });
    </script>
</body>
</html>